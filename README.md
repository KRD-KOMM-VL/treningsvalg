treningsvalg
============

Internett-treningsvalg for stortingsvalget 2013

Bulletin Board
==============

The Bulletin Board is a public repository that contains a list with
the receipts of the votes cast during an election. This list represents
the contents of the ballot box at the time it is published. The list is 
periodically regenerated and published.

The purpose of the Bulletin Board is to provide the voter with a 
mechanism to check that the vote she cast is inside the ballot box of 
the voting system. The voter can access this list at any time during 
the election. The list is periodically refreshed, hence a vote cast
appears as soon as the list is updated.

The following sections describe the files and data provided in the 
repository and, for advanced users, how to validate its authenticity
by cryptographic means.


Data provided
-------------

The Bulletin Board repository contains two files that are periodically
updated and a README file. 

  \
 	|
	|--\bulletin_election_id.txt
	|--\bulletin_election_id.sig
	|--\README.md


The "bulletin_election_id.txt" contains the list of receipts, the 
"bulletin_election_id.sig" contains the signature of the list (for 
cryptographic verification) and the README.md contains this 
information. Note that the "election_id" is the number of election.


### List of receipts ###

The list of receipts is a Comma Separated Value (CSV) file, i.e. a file 
that contains text lines separated by commas. The first entry of the 
list is a timestamp indicating when it was created (is an integer 
that represents the number of milliseconds between the current time
and midnight January 1, 1970 UTC). The rest of the entries contain the
vote receipts organised in the following fields:

	Vote Receipt, Signature of the Receipt

The voter can check that her vote is present in the ballot box by
using this list. She only has to search the _vote receipt_ obtained after
casting the vote in this file. This can be done by opening the file 
with a regular text editor and searching the vote receipt string.
If the vote receipt string is there it means the vote is in the 
ballot box. 

*Advanced*: Both the _vote receipt_ and the _signature of the receipt_
are encoded in Base64, i.e. a string representation of the data. 
The signature is the one issued by the Return Code Generator (RCG) servers 
of the voting system. This signature proves that a particular vote was 
stored in the ballot box contained in RCG.


### Signature of the list ###

The signature of the list is performed by the Vote Collector Server (VCS) 
servers. This signature proves the list has been generated by the VCS and 
that the votes represented are stored in the ballot box of this entity.

*Advanced*: The signature, in practise, is of a SHA256 hash of the list of 
receipts contained in "bulletin_election_id.txt" in its hexadecimal
representation. Notice the hexadecimal value signed is encoded in
UTF-8 format without any space or newline character at the end. The
RSA with SHA256 algorithm and a 2048 bit key is used to sign.


Validation of the receipts list (for advanced users)
----------------------------------------------------

The authenticity and integrity of the vote receipts list can be
validated. The following paragraphs describe how to do it.

In order to validate the receipts list the following elements are required:

 - Certificate ("certificateVCS.crt") with the public key of the VCS
   (issuer of the list)
 - Certificate ("certificateRCG.crt") with the public key of the RCG
   (signer of the vote receipts)
 - List to validate ("bulletin_election_id.txt")
 - Signature of the list ("bulletin_election_id.sig")

The validation of the list has two different parts, the validation of
the authenticity of the list and the validation of the individual
receipts. The following lines show the steps required and give
examples of verification using standard commands in GNU/Linux based
systems.

In order to validate the authenticity of the list these steps must be
followed:

1.Extract public key of VCS from the certificate

	$ openssl x509 -pubkey -noout -in certificateVCS.crt > pubkeyVCS.pem


2.Perform the SHA256 of the receipts list. The hash must be created
in hexadecimal representation inside a string with no spaces or
new-line characters.

	$ sha256sum bulletin_election_id.txt | grep -o '^[^ ]*' | tr -d '\n' > sha.txt


3.Validate the signature of the list with the SHA256 obtained using
the VCS public key

	$ openssl dgst -sha256 -verify pubkeyVCS.pem -signature bulletin_election_id.sig sha.txt



In order to validate the authenticity of the individual receipts these
steps must be followed:

1.Extract the public key of the RCG certificate:

	$ openssl x509 -pubkey -noout -in certificateRCG.crt > pubkeyRCG.pem


2.Get next entry ($entry) of the list (with copy and paste, text
processor command-line tool or similar)


3.Extract receipt of the entry:

	$ echo $entry | awk -F',' '{print $1}' | grep -o '^[^ ]*' | tr -d '\n'  > receipt.txt


4.Extract the signature of the receipt (converting it from Base64 to binary):

	$ echo $entry | awk -F',' '{print $2}' | base64 -d > receipt.sig


5.Validate the signature of the receipt:

	$ openssl dgst -sha256 -verify pubkeyRCG.pem -signature receipt.sig receipt.txt


6.Goto step 2 to validate the next entry.














